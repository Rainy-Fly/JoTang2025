# Task2 
## 一.回归问题
-   预测房价的输出是通过输入一系列特征预测的房价,是连续值,因为特征的取值范围连续,并且中间的函数是连续函数
-   线性回归:拟合一条直线使尽可能多的点落在上面.最小二乘法计算残差的平方和(即均方误差*n),调整斜率与截距使损失最小
-回归模型的指标:
    -   残差平方和,及其取平均(均方误差MSE),以及进一步开根号的均方根误差(RMSE)
    -   决定系数R,[残差平方和/sum(yi-Y.mean())**2]
    -   最大误差|max(y_hat-yi)|


## 二.分类问题
### Iris
这是单标签三分类问题:n分类代表总共有n个类别,单/多标签代表一个样本是只能被分到一个类别还是可以有多个类别(如识别图片中有**哪些**动物)
<br>
混淆矩阵的行和列分别是实际类别和预测类别,一个格子的数值代表某个类别被预测为某个类别的数量是多少;
如我的模型有一次的结果是:
```
[[13.  0.  0.]
 [ 0.  7.  3.]
 [ 0.  0.  7.]]
```
说明1和3类别全部准确判断,但第二类有3个被误判成了第三类.

### Titanic
<p style="color:red;">在这个卡了我无数次的数据集上,我学习到了血与泪换来的技能点:</p>

#### 一阶段:先跑起来再说
学习用pandas按照列名分类处理:抛弃姓名,票号,船舱号,ID;数值型的不动,字符型的用torch.eye和高级索引独热编码,再统一用平均值fillna,然后如法炮制神经网络;另外学习了F1score的计算:FP/FN/TP/TN,召回率,精确率.整个过程主要是花费大量时间了解pandas结构和各种索引相关知识点(loc/iloc,index,columns),最终得到满屏**Nan**
#### 二阶段:与**Nan**做无尽斗争
最开始只知道a减小学习率与换激活函数,隐藏层的激活函数试relu,leaky_relu,sigmoid,tanh,依旧无果<br>
之后寻寻觅觅,我熟悉了断点调试,发现TP/FP/FP/FN中有一对立马保持0,接着一步步追溯nan开始的地方,定位到epoch=0,batch=3左右,w和b就出现了nan,之后一直都是nan;于是我一方面重写了pd的数据处理,用众数fillnan避免极端影响,另一方面对权重做标准化,加入Adam优化器,Reduce调度器,以及Clip裁剪u权重和偏置,最终消灭nan;
#### 三阶段:提升指标
在Ai的帮助下,我发现我的模型的重大失误:训练集,验证集,测试集并没有根据生存死亡随机抽样,导致不同数据集的生死比例不同,使得规律混乱;于是,我用DataFrame.query分开了生者与死者,再用concat按比例分层抽样,最终指标得到提高:<br>

每隔10个epoch,我打印了一个epoch验证集和训练集的指标(此处n展示acc)
```
epoch  acc
50	0.6595588235294119
60	0.6659836065573771
70	0.666725352112676
80	0.6692901234567901
90	0.6688186813186813
100	0.6711633663366336
110	0.672972972972973
120	0.6776717557251909
```
可以看到acc在稳步上升
然而在最终的测试集上指标有所波动,尤其是acc
```
acc= 0.5875
premise= 0.5874996328127294
recall= 0.9999989361713445
score= 0.7401335861991869
```
#### 四阶段:最终优化:**解决标签不平衡的问题**
国庆第二天的晚上,我决意提高0.6左右的准确率acc和精确率precise;分析指标,尽管f1score和recall好些,但是recall极高和precise低恰恰说明模型通过过分地把死者判断成生者使得生者都被召回,TP和FP都高,这与标签本身不平衡有关系.<br>
解决标签不平衡的问题的方法(简单型)有:过采样,欠采样,加权重;由于样本已经确定,我选取加权重,便学习```torch.where(condition,value1,value2)```,将类别为1的样本的通过公式```ratio=len(liveDF)/(len(liveDF)+len(dieDF))
live_weight=(1-ratio)/ratio```
设置权重,死的权重为1;在计算损失函数时应用加上权重的预测值;最终:
```
acc= 1.0
premise= 0.999998979592878
recall= 0.999998979592878
score= 0.999973980217863
```
#守得云开见月明